<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>MineDock æ§åˆ¶å°</title>
    <link rel="stylesheet" href="//unpkg.com/element-plus/dist/index.css" />
    <link rel="stylesheet" href="./css/style.css" />

    <script src="//unpkg.com/vue@3"></script>
    <script src="//unpkg.com/element-plus"></script>
    <script src="//unpkg.com/@element-plus/icons-vue"></script>
</head>

<body>
    <div id="app">
        <div class="header">
            <div class="title-group">
                <h2>ğŸ® MineDock Server Manager</h2>
            </div>
            <div class="btn-group">
                <el-button type="primary" :icon="Plus" @click="openCreateDialog">æ–°å»ºæœåŠ¡å™¨</el-button>
                <el-button :icon="Refresh" @click="fetchContainers" circle></el-button>
            </div>
        </div>

        <el-card>
            <template #header>
                <div class="card-header"><span>å®¹å™¨åˆ—è¡¨</span></div>
            </template>
            <el-table :data="containers" style="width: 100%" v-loading="loading">
                <el-table-column prop="names" label="å®¹å™¨åç§°" width="180">
                    <template #default="scope"><el-tag effect="dark">{{ scope.row.names }}</el-tag></template>
                </el-table-column>
                <el-table-column prop="image" label="é•œåƒ" width="220"></el-table-column>
                <el-table-column label="çŠ¶æ€" width="180">
                    <template #default="scope">
                        <span :class="['status-dot', scope.row.state == 'running' ? 'running' : 'exited']"></span>
                        {{ scope.row.state }}
                    </template>
                </el-table-column>
                <el-table-column label="æ“ä½œ">
                    <template #default="scope">
                        <el-button type="success" size="small" :disabled="scope.row.state === 'running'"
                            @click="handleAction(scope.row.id, 'start')">å¯åŠ¨</el-button>
                        <el-button type="danger" size="small" :disabled="scope.row.state !== 'running'"
                            @click="handleAction(scope.row.id, 'stop')">åœæ­¢</el-button>
                        <el-button type="info" size="small" @click="openConsole(scope.row.id)">æ§åˆ¶å°</el-button>
                    </template>
                </el-table-column>
            </el-table>
        </el-card>

        <el-dialog v-model="logVisible" title="ğŸ”´ å®æ—¶æ§åˆ¶å°" width="80%" :before-close="closeConsole">
            <div ref="logBox" class="log-box">
                <div v-for="(line, index) in logs" :key="index" :style="line.style">{{ line.text }}</div>
            </div>
        </el-dialog>

        <el-dialog v-model="createVisible" title="ğŸ› ï¸ åˆ›å»ºæ–°æœåŠ¡å™¨" width="600px">
            <el-form label-position="top">
                <el-row :gutter="20">
                    <el-col :span="12">
                        <el-form-item label="æœåŠ¡å™¨åç§°">
                            <el-input v-model="createForm.name" placeholder="ä¾‹å¦‚: MyCreateServer"></el-input>
                        </el-form-item>
                    </el-col>
                    <el-col :span="12">
                        <el-form-item label="ç«¯å£">
                            <el-input v-model="createForm.port" placeholder="25565"></el-input>
                        </el-form-item>
                    </el-col>
                </el-row>

                <el-form-item label="æ•°æ®ç›®å½• (å®¿ä¸»æœºç»å¯¹è·¯å¾„)">
                    <el-input v-model="createForm.dataPath" placeholder="/home/user/minecraft/xxx"></el-input>
                    <small style="color: gray">å¦‚æœä¸å¡«ï¼Œæ•°æ®å°†ä¿å­˜åœ¨ Docker å†…éƒ¨ï¼ˆä¸æ¨èï¼‰</small>
                </el-form-item>

                <el-form-item label="é•œåƒåç§° (é€‰å¡«)">
                    <el-input v-model="createForm.image" placeholder="é»˜è®¤ä¸º itzg/minecraft-server"></el-input>
                </el-form-item>

                <el-divider content-position="left">ç¯å¢ƒå˜é‡é…ç½® (Environment)</el-divider>

                <div v-for="(item, index) in createForm.envList" :key="index" style="margin-bottom: 10px;">
                    <el-row :gutter="10">
                        <el-col :span="10">
                            <el-input v-model="item.key" placeholder="å˜é‡å (å¦‚ MEMORY)"></el-input>
                        </el-col>
                        <el-col :span="10">
                            <el-input v-model="item.value" placeholder="å€¼ (å¦‚ 4G)"></el-input>
                        </el-col>
                        <el-col :span="4">
                            <el-button type="danger" :icon="Delete" circle @click="removeEnv(index)" />
                        </el-col>
                    </el-row>
                </div>
                <el-button style="width: 100%" @click="addEnv" :icon="Plus" plain>æ·»åŠ ç¯å¢ƒå˜é‡</el-button>

            </el-form>
            <template #footer>
                <span class="dialog-footer">
                    <el-button @click="createVisible = false">å–æ¶ˆ</el-button>
                    <el-button type="primary" @click="submitCreate" :loading="creating">ç«‹å³åˆ›å»º</el-button>
                </span>
            </template>
        </el-dialog>
    </div>

    <script src="./js/app.js"></script>
</body>

</html>